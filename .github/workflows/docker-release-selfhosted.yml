  deploy:
    needs: build-and-push
    runs-on: sprint-dashboard
    if: github.event_name == 'push' || (github.event_name == 'pull_request' && github.event.pull_request.merged == true)
    
    steps:
      - name: Log in to Azure Container Registry
        run: |
          echo "${{ secrets.AZURE_ACR_PASSWORD }}" | docker login ${{ env.REGISTRY }} -u Oguzhan --password-stdin
      
      - name: Pull latest image
        run: |
          cd /home/inveon/sprint-dashboard
          docker compose pull sprint-dashboard
      
      - name: Deploy with docker compose
        run: |
          cd /home/inveon/sprint-dashboard
          docker compose up -d --force-recreate sprint-dashboard
      
      - name: Clean up old images
        run: docker image prune -f
      
      - name: Check deployment status
        run: |
          cd /home/inveon/sprint-dashboard
          docker compose ps sprint-dashboard
          docker compose logs --tail=50 sprint-dashboard